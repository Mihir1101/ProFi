// SPDX-License-Identifier: UNLICENSED
pragma solidity ^0.8.18;

import "@openzeppelin/contracts/access/Ownable.sol";

contract BTC is Ownable {
    // =========================================================
    //                      Safe Math
    // =========================================================

    function SafeSub(uint256 a, uint256 b) public pure returns (uint256) {
        if (a < b) {
            return (b - a);
        } else {
            return (a - b);
        }
    }

    // ========================================================
    //        Storage Variables, events and constructors
    // ========================================================

    uint256[] private open;
    uint256[] private close;
    uint256[] private high;
    uint256[] private low;
    uint256[] private volume;
    uint256[] private marketCap;
    uint256 private markets;
    uint256 private github_commits;
    uint256[] private algo_array;

    constructor(address initialOwner) Ownable(initialOwner) {
        open = [
            1353000030518,
            1390000000000,
            1288150024414,
            975100021362,
            1062129974365,
            1351399993896,
            1326799926758,
            2038999938965,
            11289200439453,
            7549699707031,
            8286099853516,
            5499199829102,
            4570000000000,
            4476329956055,
            6236929931641,
            6413909912109,
            5862020263672,
            4777869873047,
            3874270019531,
            3386499938965,
            3782489929199,
            3204349975586,
            2168670043944,
            2542830047607,
            2442230072021,
            2359389953613,
            2302330017090,
            2633450012207,
            2846860046387,
            2302559967041,
            2360039978027,
            3150050048828,
            3774140014648,
            4307210083008,
            3693500061035,
            4379169921875,
            4167600097656,
            4484840087891,
            5311069946289,
            6725150146484,
            6246019897461,
            5755460205078,
            6099290161133,
            7013369750977,
            7460460205078,
            9636580200195,
            9709409790039,
            11800400390625,
            10717099609375,
            13483000488281,
            22883300781250,
            24926000976563,
            28713000488281,
            47017597656250,
            43410498046875,
            64409702148438,
            101985996093750,
            141122001953125,
            102372998046875,
            103850000000000,
            70030600585938,
            92514697265625,
            75007001953125,
            64116801757813,
            77690400000000,
            70448100000000,
            66198500000000,
            63181400000000,
            40244642420300,
            37467133874700,
            34605471240300,
            38537571320300,
            41053624208700,
            53509145055500,
            85738397248900,
            107969306183000,
            100774425920000,
            96305931961600,
            82997211049599,
            91939919894300,
            75716161942100,
            71948919705300,
            93463576276100,
            85997583441000,
            64373192148600,
            86727819143000,
            94636056622000,
            91459850550200,
            113225705008000,
            116793166637000,
            107952547425300,
            137809948051400,
            196337704472700,
            289940089164100,
            331145772429800,
            451595030525300,
            589265641473400,
            577146648583500,
            372937923744700,
            350359827122700,
            414608440813299,
            470997748694100,
            438167406442989,
            613204494915952,
            569079667338266,
            463117446630410,
            384817653685119,
            431945042113042,
            455541638120546,
            377132650897410,
            317925538087129,
            198204704741998,
            233367180518604,
            200504986698419,
            194311049459172,
            204948976229392,
            171680021376253,
            165479143978715,
            231378351361505,
            231509299581785,
            284733318011971,
            292271039819099,
            272184123755644,
            304718475630488,
            292308724049903,
            259340208061586
        ];
        close = [
            1321000061035,
            790999984741,
            885000000000,
            655260009766,
            1012109985352,
            1184599990845,
            1022500000000,
            2016499938965,
            4205100097656,
            7549699707031,
            4204100036621,
            4433649902344,
            3512720031738,
            4232510070801,
            5498209838867,
            5645109863281,
            4438510131836,
            3722399902344,
            2892959899902,
            3206260070801,
            3042319946289,
            1715099945068,
            2120149993896,
            2365149993896,
            2148739929199,
            2285729980469,
            2212960052490,
            2535050048828,
            1995670013428,
            2251170043945,
            2356159973145,
            3009970092773,
            3494649963379,
            3549140014648,
            3679570007324,
            3940350036621,
            4158309936523,
            4373890075684,
            5256359863281,
            6118339843750,
            5313339843750,
            5708109741211,
            6094790039063,
            6781560058594,
            7460460205078,
            7557559814453,
            9466909790039,
            9037130126953,
            10610899658203,
            13483000488281,
            22129599609375,
            18430300292969,
            26685900878906,
            29466201171875,
            41640498046875,
            55190097656250,
            96946503906250,
            94022900390625,
            60482597656250,
            66839301757813,
            65268701171875,
            70906801757813,
            58264101562500,
            61364199218750,
            59710500000000,
            61975200000000,
            62364700000000,
            35850600000000,
            31913035615700,
            34008197261900,
            33910237524800,
            37337496607700,
            40969012546300,
            53476461061000,
            75644886035300,
            91631346444899,
            94216301596500,
            78307587612600,
            74469885509100,
            66171670508000,
            65400492770900,
            69149959079300,
            84929321531200,
            41069807502900,
            62023735117300,
            83743229750800,
            89755258547300,
            89770156352500,
            110124147398000,
            99164929306300,
            104166892046900,
            132431598660000,
            176195323893800,
            287227552705800,
            323842281064800,
            451150931147800,
            471594858408300,
            306814969117800,
            288936216584400,
            293609558382700,
            374580039933500,
            397876097979604,
            433200229785376,
            535697639630968,
            428746168583905,
            331840595656615,
            344592177282867,
            372602017138385,
            376979427790922,
            263504901742248,
            177086237125896,
            189669506341661,
            196007850348256,
            182903151882250,
            183198226296141,
            155990471753829,
            163981362516753,
            165212334305290,
            214600885038644,
            196282543094205,
            270708494995525,
            258784288295359,
            247971678486154,
            289342941602457,
            254091116027686,
            249302974941684
        ];
        high = [
            1474880065918,
            1398899993896,
            1297799987793,
            1113440017700,
            1408899993896,
            1465000000000,
            2174199981689,
            11561400146484,
            11561199951172,
            10171199951172,
            8535200195313,
            7029099731445,
            5423779907227,
            6247150268555,
            6741110229492,
            6578579711914,
            5981160278320,
            4939280090332,
            4116979980469,
            4570929870605,
            3840379943848,
            3204349975586,
            2656109924316,
            3000440063477,
            2617980041504,
            2478040008545,
            2678670043945,
            3143940124512,
            2857149963379,
            2591820068359,
            3341690063477,
            4955620117188,
            4691029968262,
            4629339904785,
            4480459899902,
            4396530151367,
            4679649963379,
            5539600219727,
            7779899902344,
            7049680175781,
            6261190185547,
            6288179931641,
            7204019775391,
            7562369995117,
            9793969726563,
            11910999755859,
            12003900146484,
            12803100585938,
            13479100341797,
            27637099609375,
            29999099121094,
            29161398925781,
            47360498046875,
            49750400390625,
            64704301757813,
            115174003906250,
            200890000000000,
            177124003906250,
            119585000000000,
            117040996093750,
            97453203125000,
            99645000000000,
            77548901367188,
            84242695312500,
            77690400000000,
            73884300000000,
            69650600000000,
            65521600000000,
            43093773121600,
            41090210651600,
            42106417545400,
            42968066502000,
            56420445931200,
            90083145684600,
            137964890807000,
            131295289338999,
            122738213782999,
            108987621803000,
            100217439830000,
            95050516761900,
            77434317247400,
            95531261325100,
            104576271997000,
            91676957962300,
            94406506732599,
            99967433530400,
            101995649719000,
            114158638958000,
            123590570221000,
            120670812887000,
            140282142931700,
            197492636942500,
            292448766878600,
            419467393507900,
            583305721418500,
            616838640141200,
            648630989077000,
            595193544255900,
            412952685744900,
            422355477087400,
            504820764083400,
            528537637963000,
            669303872709899,
            687896259389221,
            590416852434855,
            478814062331605,
            456611731433747,
            480868367491568,
            473134768544721,
            399029502136511,
            319572843170438,
            245725794217469,
            251355903960686,
            226738197662856,
            209883944704235,
            214468860966908,
            183185305843610,
            239198897614091,
            251341173501960,
            291599026178662,
            310056080444729,
            298201266220765,
            313895381281357,
            318145148120678,
            301767962374838,
            274887638021952
        ];
        low = [
            1321000061035,
            790999984741,
            885000000000,
            655260009766,
            1012109985352,
            1184599990845,
            1022500000000,
            2016499938965,
            4205100097656,
            7549699707031,
            4204100036621,
            4433649902344,
            3512720031738,
            4232510070801,
            5498209838867,
            5645109863281,
            4438510131836,
            3722399902344,
            2892959899902,
            3206260070801,
            3042319946289,
            1715099945068,
            2120149993896,
            2365149993896,
            2148739929199,
            2285729980469,
            2212960052490,
            2535050048828,
            1995670013428,
            2251170043945,
            2356159973145,
            3009970092773,
            3494649963379,
            3549140014648,
            3679570007324,
            3940350036621,
            4158309936523,
            4373890075684,
            5256359863281,
            6118339843750,
            5313339843750,
            5708109741211,
            6094790039063,
            6781560058594,
            7460460205078,
            7557559814453,
            9466909790039,
            9037130126953,
            10610899658203,
            13483000488281,
            22129599609375,
            18430300292969,
            26685900878906,
            29466201171875,
            41640498046875,
            55190097656250,
            96946503906250,
            94022900390625,
            60482597656250,
            66839301757813,
            65268701171875,
            70906801757813,
            58264101562500,
            61364199218750,
            59710500000000,
            61975200000000,
            62364700000000,
            35850600000000,
            31913035615700,
            34008197261900,
            33910237524800,
            37337496607700,
            40969012546300,
            53476461061000,
            75644886035300,
            91631346444899,
            94216301596500,
            78307587612600,
            74469885509100,
            66171670508000,
            65400492770900,
            69149959079300,
            84929321531200,
            41069807502900,
            62023735117300,
            83743229750800,
            89755258547300,
            89770156352500,
            110124147398000,
            99164929306300,
            104166892046900,
            132431598660000,
            176195323893800,
            287227552705800,
            323842281064800,
            451150931147800,
            471594858408300,
            306814969117800,
            288936216584400,
            293609558382700,
            374580039933500,
            397876097979604,
            433200229785376,
            535697639630968,
            428746168583905,
            331840595656615,
            344592177282867,
            372602017138385,
            376979427790922,
            263504901742248,
            177086237125896,
            189669506341661,
            196007850348256,
            182903151882250,
            183198226296141,
            155990471753829,
            163981362516753,
            165212334305290,
            214600885038644,
            196282543094205,
            270708494995525,
            258784288295359,
            247971678486154,
            289342941602457,
            254091116027686,
            249302974941684
        ];
        volume = [
            208973000000000000,
            208973000000000000,
            208973000000000000,
            208973000000000000,
            208973000000000000,
            208973000000000000,
            208973000000000000,
            208973000000000000,
            208973000000000000,
            171079000000000000,
            280761000000000000,
            282540000000000000,
            152449000000000000,
            151071000000000000,
            464224000000000000,
            224679000000000000,
            446323000000000000,
            347073000000000000,
            125454000000000000,
            91944400000000000,
            139429000000000000,
            233482000000000000,
            139493000000000000,
            226720000000000000,
            338186000000000000,
            147308000000000000,
            445338000000000000,
            236291000000000000,
            207107000000000000,
            197435000000000000,
            485981000000000000,
            717016000000000000,
            459966000000000000,
            378943000000000000,
            606947000000000000,
            602152000000000000,
            693226000000000000,
            1384500000000000000,
            1389800000000000000,
            1108180000000000000,
            758408960000000000,
            561224000000000000,
            970644000000000000,
            840708000000000000,
            991351040000000000,
            1645820000000000000,
            1849560000000000000,
            4472870080000000000,
            4131150080000000000,
            15448299520000000000,
            8602730240000000000,
            8605749760000000000,
            19449300480000000000,
            12074499840000000000,
            23113799680000000000,
            83106897920000000000,
            121362995200000000000,
            80411601920000000000,
            69361899520000000000,
            45532697600000000000,
            86739200000000000000,
            51271301120000000000,
            45438602240000000000,
            52875300000000000000,
            44956500000000000000,
            40022800000000000000,
            41912400000000000000,
            60480167168500006912,
            46618408063199993856,
            58311982708699996160,
            83997677984599998464,
            90451224428700008448,
            138789645737999990784,
            253651909573900009472,
            272564734944700006400,
            166315206477499990016,
            114548064190099996672,
            171154741834699997184,
            265836539466299998208,
            171581947864100012032,
            211679461123000008704,
            294324897191300005888,
            357923925440100040704,
            327864688120800018432,
            669646295413099986944,
            277732902985099968512,
            157357977439900008448,
            231604697663899992064,
            222859282503100006400,
            441710737001900015616,
            303064647187599982592,
            477284803992800002048,
            467549648481900036096,
            527545426713799950336,
            534438874507900026880,
            655208262253899939840,
            523959319846799998976,
            390098476392799993856,
            340590360990399987712,
            258028453432400019456,
            347303634271200018432,
            311416819254399991808,
            322411999274799988736,
            367085946176299991040,
            369741723995800010752,
            207347304650499981312,
            356900141040100048896,
            333274271063199973376,
            238957137312799981568,
            335382106342999982080,
            262672399232500006912,
            235535918962500009984,
            332252328720600006656,
            439752480847300001792,
            456684668154100056064,
            295235765830800048128,
            112391864562299994112,
            228378286651799994368,
            205353634339799990272,
            190013275978800005120,
            146521992722700009472,
            4434730154826300129280,
            4817342142258099519488,
            3822244890870300540928,
            4377241694995200081920,
            3376373137423100018688
        ];
        marketCap = [
            15428131249999998976,
            14478702000000000000,
            10969577713499998208,
            12187778335000000512,
            15746720512500000768,
            15660384249999998976,
            24336588000000000000,
            136203893207999987712,
            91913253492500004864,
            102384118200000004096,
            68433539235000000512,
            57522944370500001792,
            56908101648799997952,
            80072486756800004096,
            82961037446799998976,
            76708410073799999488,
            63128019597499998208,
            51586213248000000000,
            45498930524500000768,
            51259581753500000256,
            43775105946800005120,
            29976923105999998976,
            35317766357499998208,
            34201128960000000000,
            33320945043800002560,
            32737564252500000768,
            37702295216000000000,
            41120894812500000768,
            33498454160000000000,
            34636257590000001024,
            46454862463500001280,
            56231959969499996160,
            64712174906800005120,
            55872533512299995136,
            66814447049999998976,
            64090628190500003840,
            69448605141499994112,
            82930357550500003840,
            105835277993999990784,
            98618664329599991808,
            91171062167000006656,
            96931987500600000512,
            111818520701000007680,
            119435366302999986176,
            154925542221999996928,
            156591865152000000000,
            191036848007999979520,
            174143228076999999488,
            219751049089000013824,
            374148132400000008192,
            407350826949999984640,
            473883347729999986688,
            777753746248000077824,
            720084287893000028160,
            1077437312909999996928,
            1710200855999999901696,
            2374658239800000118784,
            1720995599420000043008,
            1756443109969999953920,
            1182046459270000017408,
            1571638473139999997952,
            1279029993899999887360,
            1096656182000000040960,
            1336884762199999905792,
            1213466132379999928320,
            1146085194699999936512,
            1096271172260000038912,
            699046370612799995904,
            653314991577399951360,
            605539039274899996672,
            677047741070300020736,
            723393790359499964416,
            945738268274799935488,
            1520598864135499808768,
            1924420658102199910400,
            1800289596028200157184,
            1724707435161799884800,
            1490115674151599996928,
            1658042278345900032000,
            1368293910486499983360,
            1304461125984199901184,
            1701127781613199949824,
            1568959880837399838720,
            1178140772665399967744,
            1589221339090899959808,
            1739971519296800030720,
            1683156063212900188160,
            2088953085290700079104,
            2158176778218599874560,
            1995569655037699817472,
            2553720711162800111616,
            3642297294258699763712,
            5390511381077900132352,
            6164527445332899921920,
            8414289775145699508224,
            11000167867625601236992,
            10796698843196998811648,
            6989904861849700007936,
            6568525132375400644608,
            7814313798111899680768,
            8868699036026400669696,
            8246192176075200528384,
            11564858450631001636864,
            10766892325620898856960,
            8759393566787900538880,
            7290736416876800245760,
            8194147826764899942400,
            8652021192157400399872,
            7175969015087199420416,
            6057978878764900155392,
            3775262155524900126720,
            4459410742230399844352,
            3837101022949799886848,
            3724147334874499907584,
            3934130455726699577344,
            3299976336443899904000,
            3185163178722500018176,
            4460822852971899912192,
            4468467641163499700224,
            5505930538966199566336,
            5666612851453699555328,
            5277731752520099823616,
            5917582884558199586816,
            5683656217326700724224,
            5049575555506399870976,
            5258856404597600157696
        ];
        markets = 60560000000000;
        github_commits = 389770000000000;
        algo_array = new uint256[](0);
    }

    // ========================================================
    //         Functions to add data into the array
    // ========================================================

    function addOpen(uint256 item) public onlyOwner {
        open.push(item);
    }

    function addClose(uint256 item) public onlyOwner {
        close.push(item);
    }

    function addHigh(uint256 item) public onlyOwner {
        high.push(item);
    }

    function addLow(uint256 item) public onlyOwner {
        low.push(item);
    }

    function addVolume(uint256 item) public onlyOwner {
        volume.push(item);
    }

    function addMarketCap(uint256 item) public onlyOwner {
        marketCap.push(item);
    }

    function update_markets(uint256 item) public onlyOwner {
        markets = item;
    }

    function update_github_commits(uint256 item) public onlyOwner {
        github_commits = item;
    }

    // ========================================================
    //            Functions to get the data arrays
    // ========================================================

    function getParams()
        public
        view
        returns (
            uint256[] memory,
            uint256[] memory,
            uint256[] memory,
            uint256[] memory,
            uint256[] memory,
            uint256[] memory,
            uint256,
            uint256,
            uint256[] memory
        )
    {
        return (
            open,
            close,
            high,
            low,
            volume,
            marketCap,
            markets,
            github_commits,
            algo_array
        );
    }

    // ============================================================
    //           Functions used in the algorithm
    // ============================================================

    function normalize_between_zero_and_1e10(
        uint256 value
    ) public pure returns (uint256) {
        unchecked {
            while (value > 1e10) {
                value /= 10;
            }
            while (value < 0) {
                value *= 10;
            }
        }
        return uint256(value);
    }

    function check_size(
        uint256 value1,
        uint256 value2
    ) public pure returns (uint256) {
        unchecked {
            if (value1 > value2) {
                return uint256(1);
            } else {
                return uint256(0);
            }
        }
    }

    function abs(int256 n) internal pure returns (uint256) {
        unchecked {
            return uint256(n >= 0 ? n : -n);
        }
    }

    function generate_algo_array() public {
        for (uint256 i = 0; i < (open.length - 1); i++) {
            uint256 first;
            if (high[i] > low[i]) {
                first = high[i] - low[i];
            } else {
                first = low[i] - high[i];
            }
            uint256 second;
            if (close[i] > open[i]) {
                second = close[i] - open[i];
            } else {
                second = open[i] - close[i];
            }
            uint256 result;
            if (second == 0) {
                result = 1e10;
            } else {
                result = ((first * 1e10) / (second));
            }
            uint256 algo = (2 * normalize_between_zero_and_1e10(result)) +
                (2 *
                    (
                        SafeSub(
                            1e10,
                            (SafeSub(marketCap[i], marketCap[i + 1]) / 1e11)
                        )
                    )) +
                (2 *
                    (
                        SafeSub(
                            1e10,
                            (SafeSub(volume[i], volume[i + 1]) / 1e11)
                        )
                    )) +
                (1 * ((markets) / 1e4)) +
                (2 * ((github_commits) / 1e5)) +
                (1e10 * check_size(close[i], open[i]));

            algo_array.push(algo);
        }
    }

    function return_safeness_score() public view returns (uint256) {
        uint256 score_sum = 0;
        for (uint256 i = 0; i < algo_array.length; i++) {
            score_sum = score_sum + algo_array[i];
        }
        return ((score_sum) / algo_array.length);
    }
}
